!function(n,t,i){n.fn.extend({_quattro_jqSerialize:n.fn.serialize,serialize:function(){if(t.tinyMCE)try{t.tinyMCE.triggerSave()}catch(n){}return this._quattro_jqSerialize()},_quattro_jqSerializeArray:n.fn.serializeArray,serializeArray:function(){if(t.tinyMCE)try{t.tinyMCE.triggerSave()}catch(n){}return this._quattro_jqSerializeArray()}});XenForo.getEditorInForm=function(i,r,u,f){var s,e,o;if(f||(r=""),$form=n(i),$messageEditors=$form.find("textarea.MessageEditor"+(r||"")),$bbCodeEditors=$form.find(".bbCodeEditorContainer textarea"+(r||"")),$allEditors=$messageEditors.add($bbCodeEditors),$messageEditors.length==0)return!1;if($messageEditor=$messageEditors.eq(0),$bbCodesBbCodeEditor=$bbCodeEditors.eq(0),s=u.get(0),u&&typeof s.id!="undefined"&&(e=!1,$allEditors.each(function(){if(n(this).attr("id")==s.id){e=n(this);return}}),e))return e.focus(),e;if(t.tinyMCE){var h=tinyMCE.activeEditor,c=n(h.getElement()),a=c.attr("id"),l=!1;if($messageEditors.each(function(){if(n(this).attr("id")==a){l=!0;return}}),h&&l&&!c.attr("disabled"))return tinyMCE.activeEditor;if(o=$messageEditor.attr("id"),o&&typeof tinyMCE.editors[o]!="undefined"&&!$messageEditor.attr("disabled"))return tinyMCE.editors[o]}return $messageEditor.attr("disabled")?$bbCodesBbCodeEditor.length?$bbCodesBbCodeEditor:!1:$messageEditor};var u=XenForo.speed.normal,r=XenForo.speed.fast;XenForo.AttachmentInserter=function(r){var u=!1;r.hover(function(){u=n(i.activeElement)});r.click(function(i){function y(n,t){return n.hasClass("NoAttachment")&&n.hasClass("ImgFallback")?c:t}var h=r.closest(".AttachedFile").find(".Thumbnail a"),s=h.data("attachmentid"),f,e,c,o,l=XenForo._baseUrl,a=h.find("img").attr("src"),v=h.attr("href");i.preventDefault();r.attr("name")=="thumb"?(e="[ATTACH]"+s+"[/ATTACH] ",c="[img]"+l+a+"[/img]",o='<img src="'+a+'" class="attachThumb bbCodeImage" alt="attachThumb'+s+'" /> '):(e="[ATTACH=full]"+s+"[/ATTACH] ",c="[img]"+l+v+"[/img]",o='<img src="'+v+'" class="attachFull bbCodeImage" alt="attachFull'+s+'" /> ');f=XenForo.getEditorInForm(r.closest("form"),"",u);f.execCommand&&t.tinyMCE?($textarea=n(f.getElement()),o=y($textarea,o),f.execCommand("mceInsertContent",!1,o)):(e=y(f,e),f.val(f.val()+e))})};XenForo.AttachmentDeleter=function(t){t.css("display","block").click(function(t){var i=n(t.target),o=i.attr("href")||i.data("href"),u=i.closest(".AttachedFile"),s=i.closest(".AttachedFile").find(".Thumbnail a"),f=s.data("attachmentid"),e;if(o)return u.xfFadeUp(XenForo.speed.normal,null,r,"swing"),XenForo.ajax(o,"",function(n){if(XenForo.hasResponseError(n))return u.xfFadeDown(XenForo.speed.normal),!1;var t=u.closest(".AttachmentEditor");u.xfRemove(null,function(){t.trigger("AttachmentsChanged")},r,"swing")}),f&&(e=XenForo.getEditorInForm(i.closest("form"),":not(.NoAttachment)",!1,!0),typeof e.getBody()!="undefined"&&n(e.getBody()).find("img[alt=attachFull"+f+"], img[alt=attachThumb"+f+"]").remove()),!1;console.warn("Unable to locate href for attachment deletion from %o",i)})}}(jQuery,this,document)