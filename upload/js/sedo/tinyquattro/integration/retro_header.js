!function(n,t,i,r){var o=XenForo.scriptLoader.loadScript,u,e;XenForo.scriptLoader.loadScript=function(n,i,r){var u="js/sedo/tinyquattro/tinymce",f=new RegExp(u+"/tinymce(.min)?.js");f.test(n)&&(t.tinyMCEPreInit={baseURL:XenForo.baseUrl()+u,suffix:/\.min\.js/.test(n)?".min":""}),o(n,i,r)},n.fn.extend({_quattro_jqSerialize:n.fn.serialize,serialize:function(){if(t.tinyMCE)try{var n=t.tinyMCE,i="xenMceBeforeSubmit",r={};n.each(n.editors,function(n){n.fire(i,r)}),n.triggerSave()}catch(u){}return this._quattro_jqSerialize()},_quattro_jqSerializeArray:n.fn.serializeArray,serializeArray:function(){if(t.tinyMCE)try{var n=t.tinyMCE,i="xenMceBeforeSubmit",r={};n.each(n.editors,function(n){n.fire(i,r)}),n.triggerSave()}catch(u){}return this._quattro_jqSerializeArray()}}),u=XenForo.getEditorInForm,XenForo.getEditorInForm=function(i,f,e,o){var p=u(i,f),h,v,y,s,c,l;if(p&&p.$editor)return p;o||(f="");var b=n(i),a=b.find("textarea.MessageEditor"+(f||"")),d=b.find(".bbCodeEditorContainer textarea"+(f||"")),nt=a.add(d);if(a.length==0)return!1;if(h=a.eq(0),v=d.eq(0),e&&typeof e!==r&&(y=e.get(0),s=!1,typeof y.id!==r&&(nt.each(function(){if(n(this).attr("id")==y.id){s=n(this);return}}),s)))return s.focus(),s;if(t.tinyMCE){if(c=tinyMCE.activeEditor,c){var k=n(c.getElement()),g=k.attr("id"),w=!1;a.each(function(){if(n(this).attr("id")==g){w=!0;return}})}if(c&&w&&!k.attr("disabled"))return tinyMCE.activeEditor;if(l=h.attr("id"),l&&typeof tinyMCE.editors[l]!==r&&!h.attr("disabled"))return tinyMCE.editors[l]}return h.attr("disabled")?v.length?v:!1:h};var s=XenForo.AttachmentInserter,h=XenForo.speed.normal,f=XenForo.speed.fast;XenForo.AttachmentInserter=function(r){var u=!1,f;if(r.hover(function(){u=n(i.activeElement)}),f=XenForo.getEditorInForm(r.closest("form"),"",u),f.$editor)return s(r),!1;r.click(function(i){function y(n,t){return n.hasClass("NoAttachment")&&n.hasClass("ImgFallback")?c:t}var f=XenForo.getEditorInForm(r.closest("form"),"",u),h=r.closest(".AttachedFile").find(".Thumbnail a"),s=h.data("attachmentid"),e,c,o,l=XenForo._baseUrl,a=h.find("img").attr("src"),v=h.attr("href");i.preventDefault(),r.attr("name")=="thumb"?(e="[ATTACH]"+s+"[/ATTACH] ",c="[img]"+l+a+"[/img]",o='<img src="'+a+'" class="attachThumb bbCodeImage" alt="attachThumb'+s+'" /> '):(e="[ATTACH=full]"+s+"[/ATTACH] ",c="[img]"+l+v+"[/img]",o='<img src="'+v+'" class="attachFull bbCodeImage" alt="attachFull'+s+'" /> '),f.execCommand&&t.tinyMCE?($textarea=n(f.getElement()),o=y($textarea,o),f.execCommand("mceInsertContent",!1,o)):(e=y(f,e),f.val(f.val()+e))})},e=XenForo.AttachmentDeleter,XenForo.AttachmentDeleter=function(t){var i=XenForo.getEditorInForm(t.closest("form"),":not(.NoAttachment)",!1,!0);if(i.$editor)return e(t);t.css("display","block").click(function(t){var u=n(t.target),s=u.attr("href")||u.data("href"),e=u.closest(".AttachedFile"),h=u.closest(".AttachedFile").find(".Thumbnail a"),o=h.data("attachmentid");if(s)return e.xfFadeUp(XenForo.speed.normal,null,f,"swing"),XenForo.ajax(s,"",function(n){if(XenForo.hasResponseError(n))return e.xfFadeDown(XenForo.speed.normal),!1;var i=e.closest(".AttachmentEditor");e.xfRemove(null,function(){i.trigger("AttachmentsChanged")},f,"swing")}),o&&typeof i.getBody()!==r&&n(i.getBody()).find("img[alt=attachFull"+o+"], img[alt=attachThumb"+o+"]").remove(),!1;console.warn("Unable to locate href for attachment deletion from %o",u)})}}(jQuery,this,document,"undefined");