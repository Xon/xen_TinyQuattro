!function(n,t){n.fn.extend({_quattro_jqSerialize:n.fn.serialize,serialize:function(){if(t.tinyMCE)try{t.tinyMCE.triggerSave()}catch(n){}return this._quattro_jqSerialize()},_quattro_jqSerializeArray:n.fn.serializeArray,serializeArray:function(){if(t.tinyMCE)try{t.tinyMCE.triggerSave()}catch(n){}return this._quattro_jqSerializeArray()}}),XenForo.getEditorInForm=function(i){var u=n(i),r=u.find("textarea.MessageEditor");return r.length?r.prop("disabled")?u.find(".bbCodeEditorContainer textarea"):t.tinyMCE&&r.attr("id")&&tinyMCE.editors[r.attr("id")]?tinyMCE.editors[r.attr("id")]:r:!1};var f=XenForo.speed.normal,u=XenForo.speed.fast;XenForo.AttachmentInserter=function(n){n.click(function(t){var e=n.closest(".AttachedFile").find(".Thumbnail a"),r=e.data("attachmentid"),f,u,s=e.find("img").attr("src"),o=e.attr("href"),i;t.preventDefault(),n.attr("name")=="thumb"?(f="[ATTACH]"+r+"[/ATTACH] ",u='<img src="'+s+'" class="attachThumb bbCodeImage" alt="attachThumb'+r+'" /> '):(f="[ATTACH=full]"+r+"[/ATTACH] ",u='<img src="'+o+'" class="attachFull bbCodeImage" alt="attachFull'+r+'" /> '),i=XenForo.getEditorInForm(n.closest("form")),i&&(i.execCommand?(i=tinyMCE.activeEditor,i.execCommand("mceInsertContent",!1,u)):i.val(i.val()+f))})},XenForo.AttachmentDeleter=function(t){t.css("display","block").click(function(t){var i=n(t.target),o=i.attr("href")||i.data("href"),r=i.closest(".AttachedFile"),s=i.closest(".AttachedFile").find(".Thumbnail a"),f=s.data("attachmentid"),e;if(o)return r.xfFadeUp(XenForo.speed.normal,null,u,"swing"),XenForo.ajax(o,"",function(n){if(XenForo.hasResponseError(n))return r.xfFadeDown(XenForo.speed.normal),!1;var i=r.closest(".AttachmentEditor");r.xfRemove(null,function(){i.trigger("AttachmentsChanged")},u,"swing")}),f&&(e=XenForo.getEditorInForm(i.closest("form")),typeof e.getBody()!="undefined"&&n(e.getBody()).find("img[alt=attachFull"+f+"], img[alt=attachThumb"+f+"]").remove()),!1;console.warn("Unable to locate href for attachment deletion from %o",i)})}}(jQuery,this,document);