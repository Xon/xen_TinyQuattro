tinymce.create("tinymce.plugins.xen_dropping",{init:function(n){this.editor=n;var t=this;n.on("init",function(){t.$textarea=$(n.getElement()),t.$container=$(n.getContainer()),t.initDragDrop()})},initDragDrop:function(){var i;if(!this.isMobile()&&!this.$textarea.hasClass("NoAttachment")){$droparea=$('<div class="quattro_editor_drop" />');var e=this,f=function(){$droparea.removeClass("hover")},n=this.$container.closest("form").find(".AttachmentUploader"),r=n.length>0,t,u=tinymce.util.I18n;$droparea.append($("<span />").text(r?u.translate("drop_files_here_to_upload"):u.translate("uploads_are_not_available"))).appendTo(e.$container),r||$droparea.addClass("dragDisabled"),i=function(n){var t=n.originalEvent.dataTransfer;return!t||typeof t.files=="undefined"?!1:t.types&&($.inArray("Files",t.types)==-1||t.types[0]=="text/x-moz-url")?!1:!0};$([document,this.editor.dom.doc]).on("dragover",function(n){i(n)&&($droparea.addClass("hover"),clearTimeout(t),t=setTimeout(f,200))});$droparea.on("dragover",function(n){i(n)&&n.preventDefault()}).on("drop",function(i){var e,o,u;if((i.preventDefault(),clearTimeout(t),f(),r)&&(e=i.originalEvent.dataTransfer,e&&e.files&&e.files.length))for(o=0;o<e.files.length;o++){try{u=new FormData,u.append("upload",e.files[o]),u.append("_xfToken",XenForo._csrfToken),u.append("_xfNoRedirect","1"),n.find(".HiddenInput").each(function(){var n=$(this);u.append(n.data("name"),n.data("value"))})}catch(i){return}$.ajax({url:n.data("action"),method:"POST",dataType:"json",data:u,processData:!1,contentType:!1}).done(function(t){XenForo.hasResponseError(t)||n.trigger({type:"AttachmentUploaded",ajaxData:t})}).fail(function(n){try{var t=$.parseJSON(n.responseText);t&&XenForo.hasResponseError(t)}catch(i){}})}})}},isMobile:function(){return/(iPhone|iPod|iPad|BlackBerry|Android)/.test(navigator.userAgent)?!0:!1}}),tinymce.PluginManager.add("xen_dropping",tinymce.plugins.xen_dropping);