tinymce.PluginManager.add("xenadvhl",function(n){function l(){if(f.adv_hl_active=!f.adv_hl_active,f.adv_hl_active===!1)return this.active(!1),o(),!1;this.active(!0),e(),e()}function o(){n.dom.remove(n.dom.select(".adv_hl"),"adv_hl"),t=0,i=0}function e(){var l;if(f.adv_hl_active===!1)return!1;var e=n.getContent(),u=n.selection,o=!1,s=!1,k=!1,b=!1;r.normalOpen.test(e)&&(o=!0,s=!0,e=e.replace(r.normalOpen,function(n,i,r){var u,f;return t++,u='<span id="advhln_'+t+'" class="adv_hl adv_hln_'+t+'" style="background-color:'+w+'">'+i,typeof r!="undefined"&&(f=i=="[picasa"?/,/gi:/\|/gi,r=r.replace(f,'<span class="adv_hl" style="color:'+c+';font-weight:bolder;">$&</span>'),u+='<span class="adv_hl adv_hln_'+t+" tag_options_"+t+'" style="background-color:'+a+'">'+r+"</span>"),u+="]</span>"})),r.normalClose.test(e)&&(o=!0,s=!0,e=e.replace(r.normalClose,function(n,i){return t++,'<span id="advhln_'+t+'" class="adv_hl adv_hln_'+t+'" style="background-color:'+p+'">'+i+"</span>"})),r.special.test(e)&&(o=!0,k=!0,e=e.replace(r.special,function(n,t,r,u,f){return i++,u||(b=!0),'<span id="advhls_open_'+i+'" class="adv_hl adv_hls_'+i+'" style="background-color:'+y+'">'+t+'</span><span id="advhls_content_'+i+'" class="adv_hl  adv_hls_'+i+'" style="background-color:'+h+'">'+u+'</span><span id="advhls_close_'+i+'" class="adv_hl  adv_hls_'+i+'" style="background-color:'+v+'">'+f+"</span>"})),o&&(n.setContent(e),s===!0&&(u.select(n.dom.select("span#advhln_"+t)[0]),u.setContent(u.getContent())),k===!0&&(b?(u.select(n.dom.select("span#advhls_open_"+i)[0]),l=u.getContent()+'<span id="advhls_content_'+t+'" class="adv_hl adv_hls_'+t+'" style="background-color:'+h+'"><span id="adv_caretfix"></span></span>',u.setContent(l),u.select(n.dom.select("span#adv_caretfix")[0]),u.setContent(u.getContent())):(u.select(n.dom.select("span#advhls_close_"+i)[0]),u.setContent(u.getContent()))))}var f=this,u=xenMCE.Params;f.adv_hl_active=!1;var t=0,i=0,s="tags_highlighter",r={};r.normalOpen=/(\[[^\/]+?)((?==)[^\[]*?)?\](?!<[\/]?span)/gi,r.normalClose=/(\[\/([^[]+?)\])(?!<\/span>)/gi,r.special=/(\{([^\/]+?)(?:=.+?)?\})(?!<\/span>)((?:\{\2(?:=.+?)?\}(?:\{\2(?:=.+?)?\}[\s\S]*?\{\/\2\}|[\s\S])+?\{\/\2\}|[\s\S])*?)(\{\/\2\})/gi;var w=u.adv_hl_norm.open,a=u.adv_hl_norm.options,p=u.adv_hl_norm.close,y=u.adv_hl_spe.open,b=u.adv_hl_spe.options,h=u.adv_hl_spe.content,v=u.adv_hl_spe.close,c=u.adv_hl_tag_separator;n.on("init RestoreDraft",function(){o()});n.on("SaveContent XenSwitchToBbCode SavingXenDraft",function(t){o(),t.content=n.getContent()});n.on("NodeChange keydown",function(){e()});n.addButton(s,{name:s,icon:s,onclick:l})});