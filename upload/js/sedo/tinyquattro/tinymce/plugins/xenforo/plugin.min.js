(function(){xenMCE.Overlay={create:function(n,t,i){xenMCE.Overlay._Tools.loadOverlay(n,t,i)},getParams:function(){return xenMCE.Overlay._get("params")},getInputs:function(){return xenMCE.Overlay._get("inputs")},getOverlay:function(){return xenMCE.Overlay._get("$overlay")},getEditor:function(){return xenMCE.Overlay._get("editor")},getSelection:function(){return xenMCE.Overlay._get("selection")},_get:function(n){var t=xenMCE.Tools.backupOverlay;return typeof t[n]!="undefined"?t[n]:!1}},xenMCE.Templates={},tinymce.create("xenMCE.Tools",{Tools:function(n){var i=this,r=this.static,t="undefined";typeof n=="undefined"&&(n=tinymce.activeEditor),this.getEditor=function(){return n},this.isFullscreen=function(){return typeof n.plugins.fullscreen===t?!1:n.plugins.fullscreen.isFullscreen()},xenMCE.Overlay._Tools=this,typeof xenMCE.Plugins.Auto!==t&&$.each(xenMCE.Plugins.Auto,function(n,t){new t(i)})},overlayParams:{},overlayInputs:{},loadOverlay:function(n,t,i){var e=this,l=this.getEditor(),c=l.dom,o=isLink=isEmail=!1,s=url_href="",r=l.selection,h,f,v=f?0:1,a=xenMCE.Tools.backupOverlay,u;selElm=r.getNode(),anchorElm=c.getParent(selElm,"a[href]"),anchorElm&&(o=!0,r.select(anchorElm),s=r.getContent({format:"text"}),url_href=anchorElm?c.getAttrib(anchorElm,"href"):"",isEmail=url_href.indexOf("mailto")==0&&url_href.indexOf("@")>0&&url_href.indexOf("//")==-1?!0:!1,isLink=!isEmail),u=ed.settings.xen_attach.split(","),xenAttach={type:u[0],id:u[1],hash:u[2]},h=r.getContent(),f=r.getContent({format:"text"}),a.selection={sel:r,text:f,html:h,isUrl:o,isLink:isLink,isEmail:isEmail,url:{text:s,href:url_href,anchorElm:anchorElm}},typeof t!="object"&&(t={}),this.overlayParams={dialog:n,src:e.isDefined(i,"src"),onbeforeload:e.isDefined(i,"onbeforeload"),onafterload:e.isDefined(i,"onafterload"),onsubmit:e.isDefined(i,"onsubmit"),wmConfig:t},XenForo.ajax("index.php?editor/quattro-dialog",{dialog:n,selectedHtml:h,selectedText:f,isUrl:o,isLink:isLink,isEmail:isEmail,urlDatas:{text:s,href:url_href},attach:xenAttach},$.proxy(this,"_overlayLoader"))},_overlayLoader:function(n){if(!XenForo.hasResponseError(n)&&typeof n.templateHtml!="undefined"){var r=this,f=this.getEditor(),i=this.overlayParams,t=i.wmConfig,e='<div><div class="mce-xen-body">'+n.templateHtml+"</div></div>",u={};new XenForo.ExtLoader(n,function(){function v(n){return $inputs=n.find(k.toString()),$inputs.length>0&&$inputs.each(function(){var t=$(this).attr("name");t&&(u[t]=$(this).val())}),n.find("*").filter(function(){$(this).data("value")&&(u[$(this).attr("name")]={html:$(this).html(),text:$(this).text(),data:$(this).data("value")}),parseInt($(this).data("hide"))==1&&$(this).hide()}),r.overlayInputs=u,c.inputs=u,u}var o="undefined",h=f.windowManager,p=xenMCE.Phrases,w=p.insert,b=p.cancel,k=["input","textarea","select"],c=xenMCE.Tools.backupOverlay,y,l,d,a,n,s;return c.params=i,c.editor=f,$html=$(e),$title=$html.find(".mceTitle").remove(),$Submit=$html.find(".mceSubmit").remove(),$Cancel=$html.find(".mceCancel").remove(),$Submit.length==1&&(w=r.getTagName($Submit,!0)),$Cancel.length==1&&(b=r.getTagName($Cancel,!0)),v($html),$title&&(t.title=$title.text()),typeof t.title!==o&&t.title||(t.title=p.notitle),y=xenMCE.Params.overlayDefaultSize,typeof t.width===o&&(t.width=y.w),typeof t.height===o&&(t.height=y.h),typeof $title.data("width")!==o&&(t.width=parseInt($title.data("width"))),typeof $title.data("height")!==o&&(t.height=parseInt($title.data("height"))),typeof t.data!==o?($.each(t.data,function(n,t){$e=$html.find("[name="+n+"]"),$e.length==1&&(r.getTagName($e,k)?$('<span class="tmp-data-mce">'+t+"</span>").insertAfter($e).hide():$e.html(t))}),$.extend(t.data,u)):t.data=u,typeof t.onsubmit!==o&&(originalSubmit=t.onsubmit,t.onsubmit=function(n){var t=$(f.windowManager.windows[0].getEl());xenDatas=v(t),$.extend(n.data,xenDatas),originalSubmit(n,t,f,r)}),typeof t.buttons===o&&(t.buttons=[{text:w,subtype:"primary xenSubmit",minWidth:80,onclick:function(n){var t=f.windowManager.windows[0],u;$overlay=$(t.getEl()),i.onsubmit!=!1&&(u=v($overlay),$.extend(n.data,u),i.src[i.onsubmit](n,$overlay,f,r)),typeof t.find("form")[0]!="undefined"?t.find("form")[0].submit():t.submit(),t.close()}},{text:b,subtype:"xenCancel",onclick:function(){var n=f.windowManager.windows[0];n.close()}}]),t.html=$html.html(),i.onbeforeload!=!1&&(l=i.src[i.onbeforeload](t,r),typeof l!==o&&(t=l)),h.open(t),$overlay=$(h.windows[0].getEl()),xenMCE.Tools.backupOverlay.$overlay=$overlay,d=$overlay.find(".mce-xen-body").height(),h.windows[0].addClass(i.dialog),$overlay.find(".mceFocus").focus(),$overlay.find(".tmp-data-mce").each(function(){$e=$(this),$e.prev().val($e.html()),$e.remove()}),$tabs=$overlay.find(".mceTabs").addClass("mce-tabs"),$tabs=r.cleanWhiteSpace($tabs),$panes=$tabs.next(".mcePanes").children().addClass("mce-pane"),$tabs.length>0&&$panes.length>0&&($tabs.children().addClass("mce-tab"),a=$tabs.find(".mceActive").index(),$tabs.tabs($panes,{current:"mce-active",initialIndex:a>=0?a:0})),n="mceSlides",$slides=$overlay.find("."+n),$slides.length>0&&(s=d-40,$slides.height(s).children().height(s),$slider_tabs=$overlay.find("."+n+"Tabs"),$('<a class="'+n+"Navig "+n+'Backward">&lsaquo;</a><a class="'+n+"Navig "+n+'Forward">&rsaquo;</a>').insertBefore($slides),$overlay.find("."+n+"Navig").css("top",s/2-10+"px"),$slider_tabs.tabs($slides.children(),{effect:"fade",fadeOutSpeed:"fast",rotate:!0}).slideshow({prev:"."+n+"Backward",next:"."+n+"Forward",clickable:!1})),$multi=$overlay.find("textarea, .mce-multiline"),$multi&&(h.windows[0].off("keydown"),$multi.attr("spellcheck","false").attr("hidefocus","true")),$checkBox=$overlay.find(".xenCheckBox"),$checkBox.length>1&&($checkBox.each(function(){var r=$(this).data("phrase"),u=$(this).data("inputname"),t=$(this).data("checked")=="checked"?1:0,i='<i class="mce-ico mce-i-checkbox"></i><span>'+r+'</span><input name="'+u+'" type="hidden" value="'+t+'" />';t&&$(this).addClass("mce-checked"),$(i).prependTo($(this))}),r._initCheckBox($checkBox)),i.onafterload!=!1&&i.src[i.onafterload]($overlay,u,f,r),!1})}},_initCheckBox:function(n){n.children("i").unbind("click").bind("click",function(){$parent=$(this).parent(),$input=$(this).siblings("input");var i=parseInt($input.val()),t="mce-checked";i?($parent.removeClass(t),$input.val(0)):($parent.addClass(t),$input.val(1))})},isDefined:function(n,t){var i="undefined";return typeof t===i?typeof n===i?!1:n:typeof n===i||typeof n[t]===i?!1:n[t]},getTagName:function(n,t,i){var r=n.get(0).tagName.toLowerCase(),u;return typeof i=="undefined"&&typeof t=="undefined"?r:(typeof t!="undefined"&&typeof t!="boolean"&&(i=t),t===!0)?(inputs=["input","textarea","select"],$.inArray(r,inputs)!==-1?n.val():n.text()):typeof i=="object"?(u=[],$.each(i,function(n,t){u.push(t.toLowerCase())}),$.inArray(r,u)!=-1?!0:!1):r==i.toLowerCase()?!0:!1},cleanWhiteSpace:function(n){return n.contents().filter(function(){return this.nodeType==3&&!/\S/.test(this.nodeValue)}).remove(),n},getButtonByName:function(n,t){var f=this.getEditor(),e=f.buttons,s=f.theme.panel.find("toolbar *"),r="undefined";if(typeof e[n]===r)return!1;var u=e[n],i=!1,o=0;return tinymce.each(u,function(){o++}),tinymce.each(s,function(n){if(n.type=="button"&&typeof n.settings!==r){var e=0;if(tinymce.each(n.settings,function(n,t){u[t]==n&&e++}),e==o)return i=n,t!=!1&&(i=n.getEl()),!1}}),i},getButtonsByProperty:function(n,t,i){var h=this.getEditor(),s=h.theme.panel.find("toolbar *"),u="undefined",r={},e;if(tinymce.each(s,function(i,f){var e=i.settings;i.type=="button"&&typeof e!==u&&(typeof t!==u&&typeof e[n]!==u&&e[n]==t?r[f]=i:(typeof t===u||t===null)&&typeof e[n]!==u&&(r[f]=i))}),typeof i!==u&&(e=$(),$.each(r,function(n,t){e=e.add($(t.getEl()))}),r=e),typeof i=="object"&&i instanceof jQuery){var c=i,f=[],o="_tmp_";$.each(r,function(n,t){f.push("#"+$(t).attr("id"))}),f=f.toString(),r=c.find(f).addClass(o).find(">:first-child").parents("."+o).removeClass(o)}return r},buildMenuItems:function(n,t,i,r){var e=[],o=[],u="undefined",f,s;return typeof t===u&&(t=n),tinymce.each(t.split(/\|/),function(n){o.push(n)}),tinymce.each(n.split(/\|/),function(n,t){if(f=typeof o[t]!==u?o[t]:"",typeof i===u)return e.push({text:n,value:f});var s={title:n,text:n,value:f,textStyle:i.replace(/{t}/g,n).replace(/{v}/g,f)};typeof r!==u&&(s.classes=r),e.push(s)}),e},createListBoxChangeHandler:function(n,t){return ed=this.getEditor(),function(){var i=this;ed.on("nodeChange",function(r){var f=ed.formatter,u=null;tinymce.each(r.parents,function(i){return tinymce.each(n,function(n){return t?f.matchNode(i,t,{value:n.value})&&(u=n.value):f.matchNode(i,n.value)&&(u=n.value),u?!1:void 0}),u?!1:void 0}),i.value(u)})}},insertBbCode:function(n,t,i){n=n.replace(/^at_/,"");var r=this.getEditor(),e=r.dom,u="MceCaretBb",s,f="["+n,o="[/"+n+"]";i||(i=r.selection.getContent()),i+='<span id="'+u+'"></span>',f+=t?"="+t+"]":"]",r.execCommand("mceInsertContent",!1,f+i+o),r.selection.select(e.get(u)),e.remove(u)},unescapeHtml:function(n,t){n=n.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#039;/g,"'"),t=="noBlank"&&(n=n.replace(/	/g,"\t").replace(/&nbsp;/g,"  ").replace(/<\/p>\n<p>/g,"\n"));var i=new RegExp("^<p>([\\s\\S]+)</p>$","i");return i.test(n)&&(n=n.match(i),n=n[1]),n},escapeHtml:function(n,t){return t!=="onlyBlank"&&(n=n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")),t!=="noBlank"&&(n=n.replace(/\t/g,"\t").replace(/ /g,"&nbsp;").replace(/\n/g,"</p>\n<p>")),n},getSelection:function(){return xenMCE.Overlay._get("selection")},zen2han:function(n){for(var t,r="",i=0,u=n.length;i<u;i++)t=n.charCodeAt(i),t=t>=65281&&t<=65392?t-65248:t,t=t===12540?45:t,r=r+String.fromCharCode(t);return r},static:{backupOverlay:{}}}),tinymce.PluginManager.add("xenforo",xenMCE.Tools);var n="xenMCE.Plugins.Auto";tinymce.create(n+".BbmButtons",{BbmButtons:function(n){$.extend(this,n),this.ed=this.getEditor();var i=this.ed,t=this,u=xenMCE.Params.bbmButtons,r="undefined";$.each(u,function(n,u){var f=u.code;if(config={name:f,tooltip:u.desc},u.type=="manual"?(config.icon=f,u.typeOpt&&(config.classes=u.typeOpt)):u.type=="text"?(config.icon=!1,config.text=u.typeOpt):(config.icon=f,config.iconset=u.iconSet),u._return=="direct"?config.onclick=function(){t.insertBbCode(n,u.tagOpt,u.tagCont)}:u._return!="kill"&&(config.onclick=function(){var f,r;t.bbm_tag=n,t.bbm_separator=u.separator,f={onsubmit:t.submit},r={src:t,onafterload:"onafterload"},t.loadOverlay("bbm_"+u.template,f,r)}),u._return=="kill"){if(typeof i.buttons[u.code]===r){console.debug('Button "'+u.code+'" not found - Dev: activate your plugin before xenforo plugin / Admin: Delete it from the BBM');return}$.extend(i.buttons[u.code],config);return}t.ed.addButton(f,config)})},onafterload:function(n,t,i,r){var u=r.overlayParams.dialog.replace("bbm_","Bbm_"),f="undefined";if(typeof xenMCE.Templates[u]!==f&&typeof xenMCE.Templates[u].onafterload!==f)xenMCE.Templates[u].onafterload(n,t,i,r)},submit:function(n,t,i,r){var u=r.overlayParams.dialog.replace("bbm_","Bbm_"),f="undefined";typeof xenMCE.Templates[u]!==f&&typeof xenMCE.Templates[u].submit!==f&&xenMCE.Templates[u].submit(n,t,i,r)}}),tinymce.create(n+".XenSwitch",{XenSwitch:function(n){$.extend(this,n),this.ed=this.getEditor();var t="xen_switch";this.ed.addButton(t,{name:t,icon:t,iconset:"xenforo",xenfright:!0,tooltip:xenMCE.Phrases.switch_text[0],onclick:$.proxy(this,"wysiwygToBbCode")})},wysiwygToBbCode:function(){var i,t,r;this.isFullscreen()==!0&&(i=this.getButtonByName("fullscreen"),i!=!1&&$(i).trigger("click")),t={content:this.ed.getContent()},this.ed.fire("XenSwitchToBbCode",t),r=t.content,XenForo.ajax("index.php?editor/to-bb-code",{html:r},$.proxy(this,"wysiwygToBbCodeSuccess"))},wysiwygToBbCodeSuccess:function(n){if(!XenForo.hasResponseError(n)&&typeof n.bbCode!="undefined"&&($container=$(this.ed.getContainer()),$existingTextArea=$(this.ed.getElement()),$textContainer=$('<div class="bbCodeEditorContainer" />'),$newTextArea=$('<textarea class="textCtrl Elastic" rows="5" />'),!$existingTextArea.attr("disabled"))){var t=$existingTextArea.attr("name").replace(/_html(]|$)/,"");$newTextArea.attr("id",t).attr("name",t).val(n.bbCode).appendTo($textContainer),$("<a />").attr("href","javascript:").text(xenMCE.Phrases.switch_text[1]).click($.proxy(this,"bbCodeToWysiwyg")).appendTo($("<div />").appendTo($textContainer)),$existingTextArea.attr("disabled",!0),$container.after($textContainer).hide(),$textContainer.xfActivate(),$newTextArea.focus(),this.$bbCodeTextContainer=$textContainer,this.$bbCodeTextArea=$newTextArea}},bbCodeToWysiwyg:function(){XenForo.ajax("index.php?editor/to-html",{bbCode:this.$bbCodeTextArea.val()},$.proxy(this,"bbCodeToWysiwygSuccess"))},bbCodeToWysiwygSuccess:function(n){var t,i;XenForo.hasResponseError(n)||typeof n.html=="undefined"||($container=$(this.ed.getContainer()),$existingTextArea=$(this.ed.getElement()),$existingTextArea.attr("disabled"))&&($existingTextArea.attr("disabled",!1),$container.show(),t={content:n.html},this.ed.fire("XenSwitchToWysiwyg",t),i=t.content,this.ed.setContent(i),this.ed.focus(),this.$bbCodeTextContainer.remove())}}),tinymce.create(n+".XenIcons",{XenIcons:function(n){var t=n.getEditor(),r=xenMCE.Phrases,u=xenMCE.Params,i="undefined";t.on("BeforeRenderUI",function(){function u(n){typeof t.buttons[n].type!==i&&delete t.buttons[n].type}tinymce.each(t.buttons,function(n,u){var f=u+"_desc";XenForo.isTouchBrowser()?typeof t.buttons[u].tooltip!==i&&delete t.buttons[u].tooltip:typeof r[f]!==i&&(t.buttons[u].tooltip=r[f])}),xenMCE.Params.extraLists!=!0&&(u("bullist"),u("numlist"))});t.on("init",function(){$buttons=n.getButtonsByProperty("iconset","xenforo",!0),$buttons.find("i.mce-ico").addClass("mce-xenforo-icons");var r=t.theme.panel.find("#statusbar");r&&r.length>0&&($statBar=$(r[0].getEl())),u.hidePath&&r.length>0&&$statBar.find(".mce-path").css("visibility","hidden")})}}),tinymce.create(n+".XenFonts",{XenFonts:function(n){for(var t=n.getEditor(),y=tinymce.ui.Factory,f,u,a="undefined",c="xen-font-size",h="font-family",l="xen-"+h,o=xenMCE.Phrases,e="",v=xenMCE.Params.oldXen,r,s=v===!0?"xx-small|x-small|small|medium|large|x-large|xx-large":"9px|10px|12px|15px|18px|22px|26px",i=1;i<8;i++)e+=o.size+" "+i,i!=7&&(e+="|");f=n.buildMenuItems(e,s,"font-size:{v}",c),t.addButton("xen_fontsize",{name:"xen_fontsize",type:"listbox",values:f,icon:!1,fixedWidth:!0,text:o.font_size,onPostRender:n.createListBoxChangeHandler(f,"fontsize"),onShow:function(n){n.control.addClass(c+"-menu"),n.control.initLayoutRect()},onclick:function(n){n.control.settings.value&&t.execCommand("FontSize",!1,n.control.settings.value)}}),u=n.buildMenuItems("Andale Mono|Arial|Arial Black|Book Antiqua|Courier New|Georgia|Helvetica|Impact|Tahoma|Times New Roman|Trebuchet MS|Verdana","andale mono,times|arial,helvetica,sans-serif|arial black,avant garde|book antiqua,palatino|courier new,courier|georgia,palatino|helvetica|impact,chicago|tahoma,arial,helvetica,sans-serif|times new roman,times|trebuchet ms,geneva|verdana,geneva",h+":{v}",l),t.addButton("xen_fontfamily",{name:"xen_fontfamily",type:"listbox",values:u,icon:!1,fixedWidth:!0,text:o.font_family,onPostRender:n.createListBoxChangeHandler(u,"fontname"),onShow:function(n){n.control.addClass(l+"-menu"),n.control.initLayoutRect()},onclick:function(n){n.control.settings.value&&t.execCommand("FontName",!1,n.control.settings.value)}}),r={},$.each(u,function(n,t){r[t.title.toLowerCase()]=t.value});t.on("preInit",function(){t.on("PreProcess SetContent",function(n){var i=t.dom;tinymce.each(i.select("span",n.node),function(n){var t=n.style.fontFamily;t&&(t=t.toLowerCase().replace(/'/g,""),t!=="serif"&&typeof r[t]!==a&&i.setStyle(n,"fontFamily",r[t]))})})})}}),tinymce.create(n+".Fright",{Fright:function(n){if(xenMCE.Params.frightMode!=!0)return!1;$.extend(this,n);var f=this,u=this.getEditor(),r="mce-top-right-body",t="mce-first",i="mce-last";u.on("postrender",function(n){if($toolbar=$(n.target.contentAreaContainer).prev(),$firstLine=$toolbar.find(".mce-toolbar").first(),$buttons=f.getButtonsByProperty("xenfright",null,$toolbar),!$buttons.length>0)return!1;$buttons.each(function(n){$e=$(this),n++,$e.hasClass(t)&&$e.removeClass(t).next().addClass(t),$e.hasClass(i)&&$e.removeClass(i).prev().addClass(i),n==1&&$e.addClass(t),n==$buttons.length&&$e.addClass(i)}),$fl=$('<div id="mce-top-right" class="mce-container mce-flow-layout-item mce-btn-group" role="toolbar" />'),$fl_body=$('<div id="'+r+'" />').append($buttons),$fl_body.prependTo($fl),$fl.prependTo($firstLine)}).on("FullscreenStateChanged",function(){$("#"+r+":first-child").addClass(t),$("#"+r+":last-child").addClass(i)})}}),tinymce.create(n+".jQueryToolsFix",{jQueryToolsFix:function(n){var t=n.getEditor(),i=xenMCE.Params;t.on("postrender",function(n){$container=$(t.getContainer()),$container.parents("form").hasClass("InlineMessageEditor")&&tinyMCE.activeEditor.execCommand("mceAutoResize",!1,n)});t.on("postrender",function(){var i=t.getDoc();if(!tinymce.isIE)try{t.settings.readonly||(i.designMode="On")}catch(r){}});i.geckoFullfix&&(XenForo._overlayConfig.onBeforeLoad=function(){if(window.tinyMCE&&tinymce.isGecko&&$(this.getTrigger()).hasClass("edit")&&($mceTextarea=$(tinyMCE.activeEditor.getElement()),!$mceTextarea.attr("disabled"))){var t=$mceTextarea.attr("id");tinyMCE.execCommand("mceRemoveEditor",!1,t),tinyMCE.execCommand("mceAddEditor",!0,t),tinyMCE.activeEditor.focus()}})}}),tinymce.create(n+".TableIntegration",{TableIntegration:function(n){return!1;var t,i,r},TableToBbCodes:function(){return this.EditorContent},TableToWysiwyg:function(){return this.EditorContent}}),tinymce.create(n+".Fullscreen",{Fullscreen:function(n){var t=n.getEditor(),i;if(typeof t.buttons.fullscreen=="undefined")return!1;if(i=t.buttons.fullscreen,tinymce.isIE&&tinymce.Env.ie<=7)return delete t.buttons.fullscreen,!1;i.xenfright=!0;t.on("FullscreenStateChanged",function(n){$container=$(t.getContainer()),$(n.target.contentDocument).find("html").css("overflow","auto"),n.state==!1&&($("html, body").animate({scrollTop:$container.offset().top},300),t.focus())})}}),tinymce.create(n+".XenLink",{XenLink:function(n){$.extend(this,n),this.ed=this.getEditor();var u=this,i=this.ed,t={},r={};t={name:"xen_link",icon:"link",shortcut:"Ctrl+K",stateSelector:"a[href]",onclick:$.proxy(this,"init")},r={type:"splitbutton",menu:u.buildMenuItems(xenMCE.Phrases.unlink),onshow:function(){$(".mce-tooltip:visible").hide()},onselect:function(){i.execCommand("unlink")}},xenMCE.Params.fastUnlink&&$.extend(t,r),i.addButton("xen_link",t),i.addButton("xen_unlink",{name:"xen_unlink",icon:"unlink",cmd:"unlink",stateSelector:"a[href]"})},init:function(){var t=xenMCE.Params.overlayLinkSize;config={width:t.w,height:t.h,onsubmit:this.submit},this.loadOverlay("link",config)},submit:function(n,t,i,r){xenMCE.Templates.Link.submit(n,t,i,r)}}),tinymce.create(n+".XenColors",{XenColors:function(n){function i(n){var i=n.panel.html,t=n.selectcmd,u=n.onclick;xenMCE.Params.extraColors==!0&&(n.panel.html=function(){var r='<div href="#" class="mceAdvPicker" data-mode="'+t+'">';return r+=xenMCE.Phrases.more_colors,r+="</div>",i()+r}),n.onshow=function(){var u=this,t,i;$(".mceAdvPicker").unbind("click").bind("click",function(n){n.preventDefault(),u.hidePanel();var t={mode:$(this).data("mode"),buttonCtrl:u};r.init(t)}),$button=$(this.getEl()),$panel=$(this.panel.getEl()),t=$button.offset(),i=$button.position(),t.top=r.isFullscreen()?i.top+$button.height()+parseInt($panel.css("marginTop")):t.top+$button.height()+parseInt($panel.css("marginTop")),$panel.offset(t)}}$.extend(this,n);var r=this,t=this.ed=this.getEditor(),u;typeof t.buttons.forecolor!="undefined"&&i(t.buttons.forecolor),typeof t.buttons.backcolor!="undefined"&&i(t.buttons.backcolor)},init:function(n){this._colorButton=n;var t=xenMCE.Params.overlayColorPickerSize;config={width:t.w,height:t.h,onsubmit:$.proxy(this,"submit")},callbacks={src:this,onafterload:"onafterload"},this.loadOverlay("colors",config,callbacks)},onafterload:function(n,t,i,r){xenMCE.Templates.ColorPicker.init(n,t,i,r)},submit:function(n,t,i,r){r=this,xenMCE.Templates.ColorPicker.submit(n,t,i,r)}}),tinymce.create(n+".XenMedia",{XenMedia:function(n){$.extend(this,n),this.ed=this.getEditor();var i=this,t=this.ed;t.addButton("xen_media",{name:"xen_media",icon:"media",onclick:$.proxy(this,"init")})},init:function(){var t=xenMCE.Params.overlayMediaSize;config={width:t.w,height:t.h,onsubmit:this.submit},this.loadOverlay("media",config)},submit:function(n,t,i,r){xenMCE.Templates.Media.submit(n,t,i,r)}}),tinymce.create(n+".XenImage",{XenImage:function(n){$.extend(this,n),this.ed=this.getEditor();var i=this,t=this.ed;t.addButton("xen_image",{name:"xen_image",icon:"image",stateSelector:"img:not([data-mce-object],[data-smilie])",onclick:$.proxy(this,"init")})},init:function(){var i=this.ed.selection.getNode(),t=xenMCE.Params.overlayImageSize;config={width:t.w,height:t.h,onsubmit:this.submit},i.nodeName=="IMG"&&(config.data={url:this.ed.dom.getAttrib(i,"src")}),this.loadOverlay("image",config)},submit:function(n,t,i,r){xenMCE.Templates.Image.submit(n,t,i,r)}}),tinymce.create(n+".XenCode",{XenCode:function(n){$.extend(this,n),this.ed=this.getEditor();var r=this,i=this.ed,t="xen_code";i.addButton(t,{name:t,icon:t,iconset:"xenforo",onclick:$.proxy(this,"init")})},init:function(){config={width:480,height:300,onsubmit:this.submit},this.loadOverlay("code",config)},submit:function(n,t,i,r){xenMCE.Templates.Code.submit(n,t,i,r)}}),tinymce.create(n+".XenQuote",{XenQuote:function(n){var i=n.getEditor(),t="xen_quote";i.addButton(t,{name:t,icon:t,iconset:"xenforo",onclick:function(){n.insertBbCode("quote",!1)}})}}),tinymce.create(n+".XenSmilies",{XenSmilies:function(n){function e(n){var o=1,f,c=i.params.xenforo_smilies,r="mceQuattroSmilie",s="";n===!0?(f=0,s="Full"):f=i.params.xSmilies;var e=t.dom,u='<div role="presentation" class="'+r+"Block"+s+'">',h='data-smilie="yes"';return tinymce.each(c,function(n,t){var s={id:n[1],desc:n[0]};if(t=e.encode(t),i.params.smiliesDesc=="bbcode"?s.desc=t:i.params.smiliesDesc=="none"&&(s.desc=""),f!=0&&o>f)return!1;u+=typeof s.id=="number"?'<a href="#"><img src="styles/default/xenforo/clear.png" alt="'+s.bbcode+'" title="'+s.desc+'" '+h+' class="'+r+" "+r+"Sprite mceSmilie"+s.id+'"  /></a>':'<a href="#"><img src="'+e.encode(s.id)+'" alt="'+s.bbcode+'" title="'+s.desc+'" '+h+' class="'+r+'" /></a>',o++}),u+="</div>"}function o(){return e()}function s(){var r=e(!0),i={type:"container",html:r,onclick:function(n){var i,r;n.preventDefault(),i=t.dom.getParent(n.target,"a"),i&&(r=$(i).html(),t.execCommand("mceInsertContent",!1,r))}},n=t.windowManager.open({title:"Smilies picker",spacing:10,padding:10,items:[i],buttons:[{text:"Close",onclick:function(){n.close()}}]})}var r;$.extend(this,n);var i=this,t=this.getEditor(),f="xen_smilies",u="xen_smilies_picker";this.params=xenMCE.Params,t.addButton(f,{name:f,icon:"emoticons",type:"panelbutton",stateSelector:"img[data-smilie]",popoverAlign:"bc-tl",panel:{autohide:!0,html:o,onclick:function(n){var r=t.dom.getParent(n.target,"a"),i;r&&(i=$(r).html(),t.execCommand("mceInsertContent",!1,i),this.hide())}}}),r={name:u,icon:u,iconset:"xenforo",tooltip:"Smilies picker",stateSelector:"img[data-smilie]"},r.onclick=i.params.smiliesSlider==!0?$.proxy(this,"init"):s,t.addButton(u,r)},init:function(){var t=this.params.overlaySmiliesSize;config={width:parseInt(t.w),height:parseInt(t.h)},callbacks={src:this,onafterload:"onafterload"},this.loadOverlay("smilies_slider",config,callbacks)},onafterload:function(n,t,i,r){xenMCE.Templates.SmiliesSlider.init(n,t,i,r)}}),tinymce.create(n+".XenNonBreaking",{XenNonBreaking:function(n){var t=n.getEditor(),r="xen_nonbreaking",i="XenNonBreaking";if(t.addCommand(i,function(){t.insertContent(t.plugins.visualchars&&t.plugins.visualchars.state?'<span data-mce-bogus="1" class="mce-nbsp">&nbsp;</span>':"&nbsp;")}),t.addButton(r,{name:r,cmd:i}),t.getParam("nonbreaking_force_tab"))t.on("keydown",function(n){if(n.keyCode==9){n.preventDefault();for(var r=0;r<4;)t.execCommand(i),r++}})}})})();